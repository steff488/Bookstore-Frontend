<!--  NAVBAR  -->
<app-navbar [showSearch]="false"></app-navbar>
<!--  END NAVBAR  -->

<div
  style="
    position: sticky;
    top: var(--navbar-height);
    background-color: var(--accent-color);
    height: 5px;
    width: 100%;
  "
></div>

<div
  style="
    height: auto;
    min-height: calc(100dvh - var(--navbar-height) - 5px);
    padding: 25px;
    background-color: var(--secondary-color);
    background: radial-gradient(
      circle at center,
      #30220c 20%,
      #27190b 60%,
      #191207 90%
    );
  "
>
  <!-- STEPPER -->
  <mat-stepper
    #stepper
    [linear]="true"
    orientation="horizontal"
    style="
      background-color: transparent;
      border-radius: 5px;
      width: 70%;
      justify-self: center;
    "
  >
    <!-- STEP 1: ORDER SUMMARY -->
    <mat-step>
      <ng-template matStepLabel>Order summary</ng-template>

      <div style="padding: 20px">
        @for(orderItem of orderItems; track orderItem.id) {
        <div
          style="
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            background-color: var(--primary-color);
            height: 150px;
            width: 100%;
            padding: 20px;
            margin-bottom: 20px;
            justify-self: center;
            border-radius: 5px;
          "
        >
          <!-- BOOK INFORMATION -->
          <section style="display: flex; flex-direction: row">
            <img
              mat-card-image
              [routerLink]="['/books', orderItem.bookId]"
              role="button"
              [src]="getOptimizedImageUrl(orderItem.coverImageUrl)"
              alt="{{ orderItem.bookTitle }} cover"
              style="
                height: 100%;
                object-fit: cover;
                margin-right: 20px;
                box-shadow: 0 2px 10px 3px rgba(40, 26, 11, 0.5);
              "
            />
            <div style="align-content: center; padding-left: 10px">
              <div
                style="font-family: 'Roboto'; font-weight: 500; font-size: 25px"
              >
                {{ orderItem.bookTitle }}
              </div>
              <div style="font-family: 'Roboto'; font-size: 18px">
                {{ orderItem.authorName }}
              </div>
            </div>
          </section>
          <!-- END BOOK INFORMATION -->

          <!-- QUANTITY AND PRICE -->
          <section style="align-content: center; font-size: 18px">
            <div class="custom-font" style="text-align: center">
              {{ orderItem.quantity }} x {{ (orderItem.price *
              orderItem.quantity) | number: '1.2-2' }} lei
            </div>
          </section>
          <!-- END QUANTITY AND PRICE -->
        </div>

        <mat-divider
          style="margin-top: 20px; margin-bottom: 20px"
        ></mat-divider>
        }
      </div>

      <div style="text-align: right; padding-left: 20px; padding-right: 20px">
        <button
          mat-raised-button
          matStepperNext
          style="
            background-color: var(--accent-color);
            color: var(--secondary-color);
            border-radius: 5px;
            padding: 8px 24px;
            font-size: 16px;
          "
        >
          Next: Shipping Information
        </button>
      </div>
    </mat-step>

    <!-- STEP 2: SHIPPING INFORMATION -->
    <mat-step
      [stepControl]="shippingFormGroup"
      errorMessage="Shipping information is required."
    >
      <form [formGroup]="shippingFormGroup">
        <ng-template matStepLabel>Shipping Information</ng-template>

        <div style="padding: 20px">
          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 20px;
              margin-bottom: 20px;
            "
          >
            <!-- COUNTY -->
            <mat-form-field appearance="outline" style="width: 100%">
              <mat-label>County</mat-label>
              <input
                matInput
                placeholder="Enter county"
                formControlName="county"
                required
              />
              @if (shippingFormGroup.get('county')?.hasError('required')) {
              <mat-error> County is required </mat-error>
              }
            </mat-form-field>

            <!-- TOWN -->
            <mat-form-field appearance="outline" style="width: 100%">
              <mat-label>Town</mat-label>
              <input
                matInput
                placeholder="Enter town"
                formControlName="town"
                required
              />
              @if (shippingFormGroup.get('town')?.hasError('required')) {
              <mat-error> Town is required </mat-error>
              }
            </mat-form-field>
          </div>

          <!-- ADDRESS -->
          <mat-form-field
            appearance="outline"
            style="width: 100%; margin-bottom: 20px"
          >
            <mat-label>Address</mat-label>
            <input
              matInput
              placeholder="Enter your full address"
              formControlName="address"
              required
            />
            @if (shippingFormGroup.get('address')?.hasError('required')) {
            <mat-error> Address is required </mat-error>
            }
          </mat-form-field>

          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: 20px;
              margin-bottom: 20px;
            "
          >
            <!-- POSTAL CODE -->
            <mat-form-field appearance="outline" style="width: 100%">
              <mat-label>Postal Code</mat-label>
              <input
                matInput
                placeholder="Enter postal code"
                formControlName="postalCode"
                required
              />
              @if (shippingFormGroup.get('postalCode')?.hasError('required')) {
              <mat-error> Postal code is required </mat-error>
              }
            </mat-form-field>

            <!-- PHONE NUMBER -->
            <mat-form-field appearance="outline" style="width: 100%">
              <mat-label>Phone Number</mat-label>
              <input
                matInput
                placeholder="Enter phone number"
                formControlName="phoneNumber"
                pattern="[0-9]*"
                (input)="onPhoneNumberInput($event)"
                required
              />
              @if (shippingFormGroup.get('phoneNumber')?.hasError('required')) {
              <mat-error> Phone number is required </mat-error>
              }
            </mat-form-field>
          </div>
        </div>

        <div
          style="
            display: flex;
            justify-content: space-between;
            padding-left: 20px;
            padding-right: 20px;
          "
        >
          <button
            mat-raised-button
            matStepperPrevious
            style="
              background-color: var(--accent-color);
              color: var(--secondary-color);
              border-radius: 5px;
              padding: 8px 24px;
              font-size: 16px;
            "
          >
            Back: Order Summary
          </button>
          <button
            mat-raised-button
            matStepperNext
            [disabled]="!shippingFormGroup.valid"
            [style.background-color]="shippingFormGroup.valid ? 'var(--accent-color)' : '#6c757d'"
            [style.color]="shippingFormGroup.valid ? 'var(--secondary-color)' : '#ffffff'"
            style="
              background-color: var(--accent-color);
              color: var(--secondary-color);
              border-radius: 5px;
              padding: 8px 24px;
              font-size: 16px;
            "
          >
            Next: Payment
          </button>
        </div>
      </form>
    </mat-step>

    <!-- STEP 3: PAYMENT -->
    <mat-step [stepControl]="paymentFormGroup">
      <form [formGroup]="paymentFormGroup">
        <ng-template matStepLabel>Payment</ng-template>

        <div style="padding: 40px 0; text-align: center">
          <mat-icon
            style="
              font-size: 64px;
              height: 64px;
              width: 64px;
              color: var(--accent-color);
              margin-bottom: 20px;
            "
          >
            payment
          </mat-icon>

          <h3
            style="
              font-family: 'Roboto';
              font-size: 1.3rem;
              font-weight: 600;
              color: var(--secondary-color);
              margin-bottom: 15px;
            "
          >
            Payment Step
          </h3>

          <p
            style="
              font-family: 'Roboto';
              color: var(--secondary-color);
              opacity: 0.8;
              font-size: 14px;
            "
          >
            Payment integration coming soon.
          </p>
        </div>

        <div
          style="
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-left: 20px;
            padding-right: 20px;
          "
        >
          <button
            mat-raised-button
            matStepperPrevious
            style="
              background-color: var(--accent-color);
              color: var(--secondary-color);
              border-radius: 5px;
              padding: 8px 24px;
              font-size: 16px;
            "
          >
            Back: Shipping Information
          </button>

          <button
            mat-raised-button
            style="
              background-color: var(--accent-color);
              color: var(--secondary-color);
              border-radius: 5px;
              padding: 8px 24px;
              font-size: 16px;
            "
          >
            Complete Order
          </button>
        </div>
      </form>
    </mat-step>
  </mat-stepper>
  <!-- END STEPPER -->
</div>

<!-- Custom Stepper Styles -->
<style>
  ::ng-deep .mat-horizontal-stepper-header-container {
    background-color: var(--primary-color);
    border-radius: 5px;
  }

  ::ng-deep .mat-horizontal-content-container {
    padding: 24px !important;
    background-color: var(--primary-color) !important;
    border-radius: 5px !important;
    margin-top: 20px !important;
  }
</style>
